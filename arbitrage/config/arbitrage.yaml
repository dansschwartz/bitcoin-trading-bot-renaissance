# === Renaissance of One — Arbitrage Configuration ===
# ALL thresholds live here. Change this file, not code.

exchanges:
  primary: mexc
  secondary: binance
  mexc_order_rate_limit_per_second: 5

websocket:
  enabled: true
  mexc_endpoint: "wss://wbs-api.mexc.com/ws"
  mexc_ping_interval_seconds: 15
  mexc_depth_levels: 20
  binance_endpoint: "wss://stream.binance.com:9443/ws"
  binance_depth_levels: 20
  binance_depth_update_speed_ms: 100
  max_connection_age_hours: 23
  max_reconnect_attempts: 3
  rest_fallback_duration_seconds: 60

pairs:
  phase_1:                              # Large-cap — tight spreads, high liquidity
    - BTC/USDT
    - ETH/USDT
    - SOL/USDT
    - XRP/USDT
    - BNB/USDT
    - DOGE/USDT
    - ADA/USDT
    - AVAX/USDT
    - LINK/USDT
    - DOT/USDT
  phase_2:                              # Mid-cap — wider spreads, cross-exchange edge
    - VANRY/USDT
    - NTRN/USDT
    - G/USDT
    - DUSK/USDT
    - ZKP/USDT
    - COTI/USDT
    - POL/USDT
    - SONIC/USDT
    - NEAR/USDT
    - ALGO/USDT
    - ATOM/USDT
    - FIL/USDT
    - IMX/USDT
    - ARB/USDT
    - OP/USDT
    - APE/USDT
    - SAND/USDT
    - MANA/USDT
    - GALA/USDT
    - ENJ/USDT

cross_exchange:
  enabled: true                        # Re-enabled with dynamic pair discovery
  min_net_spread_bps: 1.0
  signal_ttl_seconds: 5
  min_trade_usd: 10                    # Low for paper trading — raise to $100+ for live
  max_trade_usd: 2000              # Must be ≤ risk.max_single_arb_usd
  scan_interval_ms: 100
  fill_timeout_seconds: 3
  emergency_close_seconds: 5
  order_type: LIMIT_MAKER

pair_discovery:
  enabled: true
  scan_interval_sec: 60                # How often to scan all tickers
  max_active_pairs: 40                 # Top N pairs to monitor with full order books
  min_gross_spread_bps: 3.0            # Minimum gross spread to consider a pair
  max_gross_spread_bps: 500.0          # Maximum — above 5% is bogus (different tokens, stale data)
  min_volume_usdt: 10000               # Minimum 24h USDT volume (from Binance)
  demotion_grace_scans: 3              # Keep pair for N scans after it drops below threshold
  excluded_bases:                      # Additional exclusions beyond hardcoded set
    - USDC
    - BUSD
    - DAI
    - TUSD
    - FDUSD
    - WBTC
    - WETH

funding_rate:
  enabled: true
  observation_mode: true             # Log only, don't trade — collect data first
  entry_threshold: 0.0001            # 0.01% — minimum rate to enter
  exit_threshold: 0.00005            # 0.005% — rate considered normalized
  max_position_usd: 1000             # Max per-symbol position
  max_total_positions: 3             # Max simultaneous funding positions
  check_interval_seconds: 60         # How often to check rates
  min_differential_apr: 5.0          # Legacy — kept for backward compat
  close_differential_apr: 2.0
  max_leverage: 3.0

triangular:
  min_net_profit_bps: 5.0           # Must clear taker fees (3×0.05%=1.5bps) + slippage
  exchange: mexc
  start_currencies:
    - USDT
  scan_interval_ms: 5000            # REST polling interval
  scan_interval_ms_ws: 500          # WebSocket mode: 500ms (data already in memory)
  scan_interval_ms_rest: 5000       # REST fallback interval
  max_single_trade_usd: 15000      # Hard cap per trade (raised ceiling — depth sizing scales down)
  max_trade_usd: 3000               # Legacy — kept for backward compat, overridden by max_single_trade_usd
  min_trade_usd: 50                 # Floor — skip if optimal is below this
  max_depth_fraction: 0.15          # Use at most 15% of thinnest leg's depth (was 0.25)
  max_capital_per_cycle: 25000      # Total USD deployed per 60s cycle
  hourly_capital_limit: 500000      # Hourly capital breaker
  dynamic_sizing_enabled: true      # Master switch for dynamic sizing
  observation_mode: false           # 3-leg executor now handles triangular trades directly
  max_signals_per_cycle: 2          # Max 3-leg signals per 60s window
  adaptive_threshold_enabled: true  # Enable adaptive min_profit_bps auto-tuning
  adaptive_threshold:
    check_interval_attempts: 500    # Re-evaluate every N attempts
    raise_if_fill_rate_below: 0.25  # Raise threshold if marginal trades fill <25%
    lower_if_fill_rate_above: 0.60  # Lower threshold if marginal trades fill >60%
    step_size_bps: 0.5              # Adjust by 0.5 bps at a time
    floor_bps: 3.0                  # Never go below 3.0 bps
    ceiling_bps: 15.0               # Never go above 15.0 bps
  edge_scaling:                     # Edge-quality scaling: small edges → smaller positions
    thin_bps: 5                     # <5 bps → 0.5x size
    moderate_bps: 10                # 5-10 bps → 0.75x size
    full_bps: 20                    # ≥10 bps → 1.0x size

quadrangular:
  enabled: true
  max_signals_per_cycle: 1          # Dedicated slot for 4-leg trades
  min_net_profit_bps: 6.0           # Higher than 3-leg — extra leg = extra risk

triangular_bybit:
  enabled: false                     # Enable after observation period
  min_net_profit_bps: 35.0           # Bybit maker fee 0.10% × 3 legs = 30bps + 5bps buffer
  exchange: bybit
  start_currencies:
    - USDT
  scan_interval_ms: 5000
  max_trade_usd: 500                 # Start conservative
  observation_mode: true             # MUST start in observation mode
  max_signals_per_cycle: 2

inventory:
  target_allocation: 0.50
  rebalance_threshold: 0.70
  min_rebalance_usd: 500
  check_interval_minutes: 15
  preferred_networks:
    USDT: TRC20
    USDC: SOL
    BTC: BTC
    ETH: ARB
    SOL: SOL

risk:
  max_single_arb_usd: 15000
  max_total_exposure_usd: 10000
  max_one_sided_usd: 200
  max_daily_loss_usd: 100
  max_funding_position_usd: 2000
  max_trades_per_hour: 2000
  max_consecutive_losses: 10
  max_api_latency_ms: 500
  max_book_staleness_sec: 10        # Matches unified_book.py is_fresh window
  min_exchange_balance_usd: 100

safety:
  max_price_divergence_pct: 5.0     # Block if prices differ >5% between exchanges
  blocked_tokens: []                # Manual blocklist: ["LUNC", "WBTC"] etc.
  cache_ttl_hours: 24               # How often to refresh contract data

volume_participation:
  max_participation_rate: 0.02       # 2% of hourly market volume — beyond this we move the price
  min_daily_volume_usd: 500000       # $500K minimum to be tradeable (VANRY excluded at $180K)
  one_sided_block_threshold: 0.20    # Auto-block pair if >20% of trades are one-sided
  one_sided_min_samples: 50          # Need 50+ samples before evaluating one-sided rate
  # Fill rate degrades with participation (models market impact):
  # 0-0.5%: 85%, 0.5-1%: 75%, 1-2%: 60%, 2-5%: 35%, 5%+: 10%

realistic_fill:
  rebalance_cost_per_trade: 0.01    # $0.01 amortized rebalancing per trade
  bnb_discount: true                 # Binance BNB fee discount active (0.075% vs 0.1%)

paper_trading:
  enabled: true
  simulated_latency_ms: 50
  simulated_fill_rate: 0.75         # Calibrated to observed fill rate (431/577 = 75%)

logging:
  level: INFO
  file: logs/arbitrage.log
